<!-- moderation/blogs/categories.html -->
{% extends 'moderation/base.html' %}
{% load static %}

{% block content %}
<!-- Таблица категорий -->
<div id="blog-list">
    <div class="table-responsive">
        <table class="table table-hover table-striped align-middle">
            <thead class="table-dark">
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Изображение</th>
                <th scope="col">Название</th>
                <th scope="col">Описание</th>
                <th scope="col">Действия</th>
            </tr>
            </thead>
            <tbody id="categories-items">
                {% include "moderation/blogs/partials/categories_rows.html" %}
            </tbody>
        </table>
    </div>

    <!-- Пагинация -->
    <div id="pagination-container">
        {% include "moderation/blogs/partials/categories_pagination.html" %}
    </div>
</div>

<!-- индикатор загрузки -->
<div id="loading-indicator" class="text-center my-3" style="display:none;">
    <div class="spinner-border text-primary" role="status"></div>
</div>

<!-- Скрытый элемент для обновления пагинации -->
<script>
    document.body.addEventListener('updatePagination', function() {
        // Получаем текущий номер страницы из URL или атрибута кнопки
        const nextButton = document.querySelector('#pagination-container button');
        if (nextButton) {
            const currentUrl = nextButton.getAttribute('hx-get');
            if (currentUrl) {
                // Извлекаем номер страницы из URL
                const matches = currentUrl.match(/\/page\/(\d+)\//);
                if (matches && matches[1]) {
                    const nextPage = parseInt(matches[1]) + 1;
                    // Обновляем URL кнопки
                    nextButton.setAttribute('hx-get', currentUrl.replace(/\/page\/\d+\//, `/page/${nextPage}/`));
                }
            }
        }
    });
</script>
{% endblock %}

{% block demo %}
<!-- Кнопка создания -->
<div class="buy-now">
    <a href="#"
       class="btn btn-danger btn-buy-now"
       hx-get="{% url 'blogs:categories_form' %}"
       hx-target="#offcanvas-body-content"
       hx-trigger="click"
       data-bs-toggle="offcanvas"
       data-bs-target="#offcanvasRight">
        Создать
    </a>
</div>

<!-- Offcanvas справа -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" style="width: 100%; max-width: 450px;">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title">Категория</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body" id="offcanvas-body-content">
        <!-- Сюда загружается форма -->
    </div>
</div>
{% endblock demo %}